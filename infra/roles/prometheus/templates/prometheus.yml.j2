---
# my global config
global:
  scrape_interval:     30s # Set the scrape interval to every 30 seconds. Default is every 1 minute.
  evaluation_interval: 30s # Evaluate rules every 30 seconds. The default is every 1 minute.
  # scrape_timeout is set to the global default (10s).

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - localhost:9093

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
rule_files:
# - "first_rules.yml"
# - "second_rules.yml"

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=job_name` to any timeseries scraped from this config.
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
  - job_name: 'alertmanager'
    static_configs:
      - targets: ['localhost:9093']
  - job_name: 'grafana'
    static_configs:
      - targets: ['localhost:3000']
#  - job_name: 'kubernetes'
#    kubernetes_sd_configs:
#    - role: nodes
#      api_server: kubernetes.internal.podspace.net:6443
#      tls_config:
#        ca_file: /tmp/ca.crt
#      bearer_token_file: /tmp/token
#  - job_name: 'kube_nodes'
#    static_configs:
#      - targets: ['ezkm-0.internal.podspace.net:6443']
#    metrics_path: '/apis/metrics.k8s.io/v1beta/nodes'
#  - job_name: 'consul'
#    # dashboard 10642 is good for cluster.
#    static_configs:
#      - targets: [{% for item in consul_servers %}
#                     "{{ item }}:8500"{{ "" if loop.last else "," }}
#                  {% endfor %}]
#    metrics_path: '/v1/agent/metrics'
#    params:
#      format: ['prometheus']
  - job_name: 'services'
    consul_sd_configs:
      - token: anonymous
        datacenter: us-east-2
        tags:
          - app
    relabel_configs:
      - source_labels: [__meta_consul_service_metadata_metrics_path]
        target_label: __metrics_path__

  - job_name: 'nodes'
    ec2_sd_configs:
      - region: us-east-2
        port: 9100
    relabel_configs:
      - source_labels: [__meta_ec2_tag_NodeExport]
        regex: true
        action: keep
      - source_labels: [__meta_ec2_tag_Name]
        target_label: hostname

  - job_name: 'kafka'
    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.
    #####CHANGE THE TARGET TO THE IP AND PORT OF JMX SERVICE JUST INSTALLED#######
    # Grafana import 721
    static_configs:
    - targets: ['kafka-00:9075', 'kafka-01:9075', 'kafka-02:9075']
      labels:
        env: 'dev'

#  - job_name: 'nodes'
#    azure_sd_configs:
#      - authentication_method: ManagedIdentity
#        environment: AzurePublicCloud
#        subscription_id: subscription_id
#        port: 9100
#    relabel_configs:
#      - source_labels: [__meta_azure_machine_tag_NodeExport]
#        regex: true
#        action: keep
#      - source_labels: [__meta_azure_machine_tag_Name]
#        target_label: hostname

#  - job_name: 'kubes'
#    ec2_sd_configs:
#      - region: us-east-2
#        port: 8080
#    relabel_configs:
#      - source_labels: [__meta_ec2_tag_KubeNode]
#        regex: true
#        action: keep
...
